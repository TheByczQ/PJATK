import bpy
from mathutils.geometry import intersect_line_line
import matplotlib.pyplot as plt
import itertools
import numpy as np
from mpl_toolkits.mplot3d import axes3d

# położenie punktów szczegółowych twarzy dla danej kamery
punkty3 = [[np.array([[-1.12144989],
       [-1.10042959],
       [ 3.22187949]])], [np.array([[-1.10959456],
       [-1.03030896],
       [ 3.13990352]])], [np.array([[-1.08974314],
       [-0.96845437],
       [ 3.05819751]])], [np.array([[-1.07067621],
       [-0.90988374],
       [ 2.98055996]])], [np.array([[-1.04873004],
       [-0.85622442],
       [ 2.90495447]])], [np.array([[-1.01878601],
       [-0.80832449],
       [ 2.8271105 ]])], [np.array([[-0.98227681],
       [-0.76759695],
       [ 2.74987375]])], [np.array([[-0.93961074],
       [-0.73683345],
       [ 2.67644419]])], [np.array([[-0.8914293 ],
       [-0.73231793],
       [ 2.62374723]])], [np.array([[-0.84150371],
       [-0.74568382],
       [ 2.58718752]])], [np.array([[-0.79454043],
       [-0.77932277],
       [ 2.5738632 ]])], [np.array([[-0.75340388],
       [-0.82253951],
       [ 2.57594339]])], [np.array([[-0.71862662],
       [-0.87190687],
       [ 2.59053348]])], [np.array([[-0.69439252],
       [-0.92956039],
       [ 2.62395291]])], [np.array([[-0.67856042],
       [-0.99329154],
       [ 2.67185196]])], [np.array([[-0.66607392],
       [-1.06052232],
       [ 2.72659625]])], [np.array([[-0.6587661 ],
       [-1.12998558],
       [ 2.78875167]])], [np.array([[-1.11206142],
       [-1.12102686],
       [ 3.23308828]])], [np.array([[-1.08290676],
       [-1.14906311],
       [ 3.23196987]])], [np.array([[-1.04173654],
       [-1.15054142],
       [ 3.19227795]])], [np.array([[-0.99942787],
       [-1.13914791],
       [ 3.13857578]])], [np.array([[-0.95919353],
       [-1.12036953],
       [ 3.07956305]])], [np.array([[-0.87562541],
       [-1.12253983],
       [ 2.99816524]])], [np.array([[-0.83522301],
       [-1.141906  ],
       [ 2.97712901]])], [np.array([[-0.79122576],
       [-1.15525364],
       [ 2.94647939]])], [np.array([[-0.74880141],
       [-1.15351633],
       [ 2.90231774]])], [np.array([[-0.71351169],
       [-1.13375282],
       [ 2.84726451]])], [np.array([[-0.91261058],
       [-1.07200308],
       [ 2.98461366]])], [np.array([[-0.91104395],
       [-1.02159626],
       [ 2.9326402 ]])], [np.array([[-0.91125924],
       [-0.97247521],
       [ 2.88373445]])], [np.array([[-0.91062851],
       [-0.92371708],
       [ 2.83434559]])], [np.array([[-0.95080903],
       [-0.90563767],
       [ 2.85644669]])], [np.array([[-0.93010166],
       [-0.89758724],
       [ 2.82768891]])], [np.array([[-0.9062351 ],
       [-0.89228647],
       [ 2.79852157]])], [np.array([[-0.88145597],
       [-0.9013827 ],
       [ 2.78283867]])], [np.array([[-0.86096173],
       [-0.91283843],
       [ 2.77380015]])], [np.array([[-1.05716854],
       [-1.06889727],
       [ 3.1260658 ]])], [np.array([[-1.02955788],
       [-1.07415524],
       [ 3.10371312]])], [np.array([[-0.99943693],
       [-1.07360093],
       [ 3.07303786]])], [np.array([[-0.96894321],
       [-1.05990256],
       [ 3.02884577]])], [np.array([[-0.99943993],
       [-1.05189796],
       [ 3.05133789]])], [np.array([[-1.03128659],
       [-1.05231121],
       [ 3.0835978 ]])], [np.array([[-0.83999469],
       [-1.0652093 ],
       [ 2.905204  ]])], [np.array([[-0.8136217],
       [-1.0810669],
       [ 2.8946886]])], [np.array([[-0.78473503],
       [-1.08316307],
       [ 2.86789811]])], [np.array([[-0.75573752],
       [-1.07983644],
       [ 2.83557396]])], [np.array([[-0.78238949],
       [-1.06423107],
       [ 2.84662056]])], [np.array([[-0.81118362],
       [-1.06021784],
       [ 2.87140146]])], [np.array([[-0.97584613],
       [-0.8386189 ],
       [ 2.81446503]])], [np.array([[-0.94980342],
       [-0.84884452],
       [ 2.79864794]])], [np.array([[-0.92485983],
       [-0.85728611],
       [ 2.78214594]])], [np.array([[-0.90547781],
       [-0.85384831],
       [ 2.75932612]])], [np.array([[-0.88434213],
       [-0.86123584],
       [ 2.74557797]])], [np.array([[-0.85630012],
       [-0.85896024],
       [ 2.71526036]])], [np.array([[-0.82642841],
       [-0.85356598],
       [ 2.67999439]])], [np.array([[-0.85500631],
       [-0.82816867],
       [ 2.68317498]])], [np.array([[-0.88159307],
       [-0.81567314],
       [ 2.69726621]])], [np.array([[-0.90402538],
       [-0.81137039],
       [ 2.71539576]])], [np.array([[-0.92407691],
       [-0.81121457],
       [ 2.73529147]])], [np.array([[-0.95019286],
       [-0.81898425],
       [ 2.76917711]])], [np.array([[-0.96371437],
       [-0.8382771 ],
       [ 2.80199147]])], [np.array([[-0.92435213],
       [-0.83988311],
       [ 2.76423524]])], [np.array([[-0.90502375],
       [-0.83820823],
       [ 2.74323198]])], [np.array([[-0.88405406],
       [-0.84316261],
       [ 2.72721666]])], [np.array([[-0.83949507],
       [-0.85063097],
       [ 2.69012604]])], [np.array([[-0.88407876],
       [-0.84234377],
       [ 2.72642253]])], [np.array([[-0.90506439],
       [-0.836566  ],
       [ 2.74163039]])], [np.array([[-0.92523171],
       [-0.83819603],
       [ 2.76342774]])]]
punkty4 = [[np.array([[-1909.74311851],
       [   33.05722816],
       [  744.07560031]])], [np.array([[-1899.59623967],
       [   71.56077525],
       [  737.64990145]])], [np.array([[-1885.5403195 ],
       [  109.43134946],
       [  729.73729373]])], [np.array([[-1861.01112842],
       [  144.29327715],
       [  717.92480412]])], [np.array([[-1817.56964853],
       [  170.69219111],
       [  699.26371151]])], [np.array([[-1762.62453429],
       [  188.58626252],
       [  676.6514485 ]])], [np.array([[-1703.01592526],
       [  197.91384855],
       [  652.76458019]])], [np.array([[-1642.12761688],
       [  198.57846914],
       [  628.93141251]])], [np.array([[-1595.43660832],
       [  189.38796344],
       [  611.27542172]])], [np.array([[-1567.04415067],
       [  176.10633564],
       [  601.03065655]])], [np.array([[-1557.49404813],
       [  154.64763846],
       [  598.67075848]])], [np.array([[-1555.01867264],
       [  131.31695654],
       [  599.19479727]])], [np.array([[-1551.08845143],
       [  107.44147321],
       [  599.18521125]])], [np.array([[-1546.22198469],
       [   85.86828768],
       [  598.66265246]])], [np.array([[-1542.82339187],
       [   64.94770312],
       [  598.6719187 ]])], [np.array([[-1543.11090878],
       [   44.77293607],
       [  600.07377574]])], [np.array([[-1549.33288587],
       [   25.3602829 ],
       [  603.74567248]])], [np.array([[-1768.89084815],
       [   23.73675064],
       [  689.63659922]])], [np.array([[-1733.28589933],
       [   11.57459476],
       [  676.50216766]])], [np.array([[-1693.17985423],
       [    3.97176353],
       [  661.31761797]])], [np.array([[-1652.04537222],
       [    4.24761366],
       [  645.22764655]])], [np.array([[-1618.17778648],
       [   10.4585311 ],
       [  631.59769198]])], [np.array([[-1569.11030947],
       [    7.81556681],
       [  612.59465043]])], [np.array([[-1.55763155e+03],
       [-8.78990283e-02],
       [ 6.08614761e+02]])], [np.array([[-1543.87069637],
       [   -6.16230934],
       [  603.62628807]])], [np.array([[-1532.29107175],
       [   -9.80449526],
       [  599.33461839]])], [np.array([[-1523.20112806],
       [   -6.95365878],
       [  595.60071706]])], [np.array([[-1589.90101388],
       [   34.52870397],
       [  619.01070203]])], [np.array([[-1578.04944212],
       [   53.92276772],
       [  613.1403606 ]])], [np.array([[-1566.32555842],
       [   73.1078811 ],
       [  607.33326585]])], [np.array([[-1553.97522141],
       [   92.02503935],
       [  601.29852604]])], [np.array([[-1612.27209632],
       [  109.63940173],
       [  622.9508084 ]])], [np.array([[-1590.86960032],
       [  110.0871487 ],
       [  614.55966329]])], [np.array([[-1569.87099875],
       [  110.52644607],
       [  606.32687059]])], [np.array([[-1555.84167235],
       [  105.10099967],
       [  601.19201824]])], [np.array([[-1546.74330806],
       [   96.94024114],
       [  598.15865811]])], [np.array([[-1730.15763792],
       [   43.84558889],
       [  673.21719784]])], [np.array([[-1703.76999674],
       [   36.93531658],
       [  663.34852816]])], [np.array([[-1677.55032555],
       [   34.54250982],
       [  653.25674466]])], [np.array([[-1657.6861524 ],
       [   41.20798877],
       [  645.06924274]])], [np.array([[-1677.19804586],
       [   47.19365447],
       [  652.31047266]])], [np.array([[-1703.50200771],
       [   48.74912509],
       [  662.48871102]])], [np.array([[-1576.17067524],
       [   31.89883324],
       [  613.81398654]])], [np.array([[-1561.66886674],
       [   22.7680479 ],
       [  608.73135805]])], [np.array([[-1544.58840708],
       [   19.59745687],
       [  602.26022225]])], [np.array([[-1534.57719439],
       [   23.21207306],
       [  598.11753781]])], [np.array([[-1541.38568499],
       [   30.44705185],
       [  600.31535652]])], [np.array([[-1558.49693749],
       [   32.77743721],
       [  606.85222757]])], [np.array([[-1657.63926601],
       [  147.93703307],
       [  638.2290913 ]])], [np.array([[-1619.38636898],
       [  136.85612267],
       [  623.99092543]])], [np.array([[-1589.18049358],
       [  128.67203332],
       [  612.71178869]])], [np.array([[-1574.40753895],
       [  128.61901996],
       [  606.94298955]])], [np.array([[-1564.06766148],
       [  123.89378052],
       [  603.20494801]])], [np.array([[-1557.17899214],
       [  124.14874126],
       [  600.49706467]])], [np.array([[-1555.97566432],
       [  129.10662703],
       [  599.70999774]])], [np.array([[-1557.33652031],
       [  139.39820688],
       [  599.58391056]])], [np.array([[-1563.56678866],
       [  146.52916022],
       [  601.56245143]])], [np.array([[-1574.74967476],
       [  150.52077233],
       [  605.67677041]])], [np.array([[-1590.8679026 ],
       [  153.20824027],
       [  611.80281647]])], [np.array([[-1620.30242139],
       [  153.09315413],
       [  623.31102445]])], [np.array([[-1642.9384578 ],
       [  145.93530104],
       [  632.61303853]])], [np.array([[-1589.84675352],
       [  138.57555899],
       [  612.33910766]])], [np.array([[-1574.50771236],
       [  136.07302241],
       [  606.50569031]])], [np.array([[-1564.76134898],
       [  133.22546441],
       [  602.87953425]])], [np.array([[-1561.97572069],
       [  130.16777515],
       [  601.98655416]])], [np.array([[-1564.80256657],
       [  132.76642825],
       [  602.92497942]])], [np.array([[-1574.42450851],
       [  136.99497246],
       [  606.4142518 ]])], [np.array([[-1589.80453772],
       [  139.03968578],
       [  612.2929471 ]])]]
punkty2 = [[np.array([[-613.17584199],
       [  36.53722873],
       [1941.96023815]])], [np.array([[-607.84704607],
       [  59.8285501 ],
       [1933.68390229]])], [np.array([[-606.61121714],
       [  82.85596419],
       [1938.1852554 ]])], [np.array([[-607.15357344],
       [ 107.45554345],
       [1948.85233998]])], [np.array([[-607.35245067],
       [ 134.23246882],
       [1959.23222953]])], [np.array([[-606.01909216],
       [ 162.78904502],
       [1965.44099162]])], [np.array([[-604.45997552],
       [ 190.35014496],
       [1970.57703071]])], [np.array([[-605.88380327],
       [ 220.35006204],
       [1985.98389964]])], [np.array([[-622.61036727],
       [ 242.16473482],
       [2046.54153783]])], [np.array([[-654.36672669],
       [ 257.01828892],
       [2151.83737695]])], [np.array([[-696.85440165],
       [ 261.18860636],
       [2286.99528035]])], [np.array([[-739.65799109],
       [ 252.00736251],
       [2418.28311356]])], [np.array([[-784.64701226],
       [ 233.74302687],
       [2553.13609446]])], [np.array([[-821.79943721],
       [ 200.12023861],
       [2657.74540761]])], [np.array([[-845.7068266 ],
       [ 150.21449273],
       [2714.76282217]])], [np.array([[-862.12916677],
       [  91.23665412],
       [2744.93231576]])], [np.array([[-875.92327672],
       [  30.65573967],
       [2766.25112619]])], [np.array([[-598.67406238],
       [  -2.21930312],
       [1882.22871862]])], [np.array([[-601.57175274],
       [  -7.79564297],
       [1889.31161748]])], [np.array([[-606.7524528 ],
       [  -6.28859944],
       [1906.15573625]])], [np.array([[-6.12717934e+02],
       [ 3.05457259e-01],
       [ 1.92732138e+03]])], [np.array([[-618.44859627],
       [   9.00330542],
       [1948.5148    ]])], [np.array([[-645.92773877],
       [   9.19752939],
       [2035.01715309]])], [np.array([[-6.69764878e+02],
       [ 1.08025102e-01],
       [ 2.10668222e+03]])], [np.array([[-698.42895285],
       [  -3.13442453],
       [2195.65969139]])], [np.array([[-726.31282166],
       [   6.42811144],
       [2286.8477585 ]])], [np.array([[-750.65903162],
       [  22.07508659],
       [2369.1250914 ]])], [np.array([[-628.41408829],
       [  39.51956589],
       [1990.97631208]])], [np.array([[-618.50469277],
       [  64.4891846 ],
       [1968.90374736]])], [np.array([[-608.09329443],
       [  88.28831651],
       [1944.82581938]])], [np.array([[-597.4409173 ],
       [ 111.9479447 ],
       [1919.93910938]])], [np.array([[-596.08405391],
       [ 115.108011  ],
       [1916.8224503 ]])], [np.array([[-600.59193442],
       [ 126.05105098],
       [1934.98767726]])], [np.array([[-608.31556411],
       [ 133.49214441],
       [1961.99187439]])], [np.array([[-621.58340179],
       [ 132.77279421],
       [2003.46185994]])], [np.array([[-635.34893431],
       [ 132.0264602 ],
       [2046.4874417 ]])], [np.array([[-603.82769638],
       [  30.54108037],
       [1910.37273255]])], [np.array([[-607.55797922],
       [  29.6193544 ],
       [1921.77002042]])], [np.array([[-615.23242063],
       [  31.80661736],
       [1946.70562745]])], [np.array([[-623.36188604],
       [  37.16062295],
       [1974.2260327 ]])], [np.array([[-614.67117999],
       [  37.28557989],
       [1946.9362147 ]])], [np.array([[-607.21916193],
       [  36.074213  ],
       [1923.05570894]])], [np.array([[-673.0796667 ],
       [  46.78020351],
       [2134.11023828]])], [np.array([[-685.50807695],
       [  42.67208578],
       [2171.7054615 ]])], [np.array([[-699.58881601],
       [  45.41601039],
       [2216.99391729]])], [np.array([[-718.24462304],
       [  49.47481451],
       [2277.15156327]])], [np.array([[-699.65181591],
       [  53.37158524],
       [2220.09014649]])], [np.array([[-684.87452516],
       [  51.48423121],
       [2172.92282302]])], [np.array([[-606.36795727],
       [ 160.83173351],
       [1965.82528228]])], [np.array([[-602.74816031],
       [ 150.81912118],
       [1950.79232947]])], [np.array([[-605.13658056],
       [ 149.02343648],
       [1957.65061851]])], [np.array([[-610.05789564],
       [ 154.27453116],
       [1975.04277024]])], [np.array([[-618.55825627],
       [ 154.45879651],
       [2001.8465288 ]])], [np.array([[-636.56375931],
       [ 165.23034623],
       [2062.40407127]])], [np.array([[-659.77404895],
       [ 182.50501868],
       [2141.70147462]])], [np.array([[-636.65871178],
       [ 192.42350878],
       [2072.60870849]])], [np.array([[-618.33664395],
       [ 191.98619291],
       [2014.82003284]])], [np.array([[-609.83678092],
       [ 188.74477476],
       [1986.90417384]])], [np.array([[-603.93259768],
       [ 183.88632354],
       [1966.56358782]])], [np.array([[-602.75355274],
       [ 174.08890171],
       [1959.2860515 ]])], [np.array([[-609.53718374],
       [ 161.91860316],
       [1976.18954495]])], [np.array([[-605.27396132],
       [ 159.93807268],
       [1962.05873443]])], [np.array([[-610.15818557],
       [ 163.17610031],
       [1978.60089837]])], [np.array([[-618.22537143],
       [ 165.95480367],
       [2004.98727637]])], [np.array([[-651.52938401],
       [ 180.19419847],
       [2114.9273037 ]])], [np.array([[-618.42841475],
       [ 174.49190186],
       [2008.73583002]])], [np.array([[-610.34681555],
       [ 171.61109399],
       [1982.26692216]])], [np.array([[-605.01554597],
       [ 166.07432803],
       [1963.48125397]])]]

dlugosc = []
colors = itertools.cycle(["r", "b", "g"])

for i in range(len(punkty3)):
    line1 = np.array([[0.0, 0.0, 0.0], [punkty3[i][0][0], punkty3[i][0][1], punkty3[i][0][2]]])  # KAM 3
    line2 = np.array([[994.79112564, 60.44413139, 588.20481106], [punkty4[i][0][0], punkty4[i][0][1], punkty4[i][0][2]]])  # KAM 4
    line3 = np.array([[-767.38397513, 66.70297933, 290.59956355], [punkty2[i][0][0], punkty2[i][0][1], punkty2[i][0][2]]])  # KAM 2

    #  obliczanie punktu na dwóch prostych,które są najbliżej za pomocą biblioteki Mathutils
    intersect = intersect_line_line(line1[0], line1[1], line2[0], line2[1])
    intersect2 = intersect_line_line(line1[0], line1[1], line3[0], line3[1])
    intersect3 = intersect_line_line(line2[0], line2[1], line3[0], line3[1])

    # środek odcinka między punktami na obu prostych
    punkt1 = (intersect[0] - intersect[1]) / 2
    punkt1 = intersect[0] - punkt1
    punkt2 = (intersect2[0] - intersect2[1]) / 2
    punkt2 = intersect2[0] - punkt2
    punkt3 = (intersect3[0] - intersect3[1]) / 2
    punkt3 = intersect3[0] - punkt3

    # wyznaczenie środka ciężkości trójkąta z tych punktów
    X = (xd[0] + xd2[0] + xd3[0]) / 3
    Y = (xd[1] + xd2[1] + xd3[1]) / 3
    Z = (xd[2] + xd2[2] + xd3[2]) / 3
    dlugosc.append([X, Y, Z])

# punkt w którym znajduje się kamera oraz punkt szczegółowy według danej kamery
X1 = [0.0,-906.2351 ]
Y1 = [0.0, -892.28647]  # KAM 3
Z1 = [0.0, 2798.52157]

X2 = [994.79112564, -1569.87099875]
Y2 = [60.44413139,110.52644607 ]  # KAM 4
Z2 = [588.20481106,606.32687059 ]

X3 = [-767.38397513,-608.31556411 ]
Y3 = [66.70297933, 133.49214441]  # KAM 2
Z3 = [290.59956355,1961.99187439 ]

fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')

# narysowanie prostych w przestrzeni 3D
ax.plot(X1, Y1, Z1)
ax.plot(X2, Y2, Z2)
ax.plot(X3, Y3, Z3)

# narysowanie punktów, w których znajduje sie kamera
ax.scatter(0.0, 0.0, 0.0, color='blue') # kam 3
ax.scatter(994.79112564, 60.44413139, 588.20481106, color='red') # kam 4
ax.scatter(-767.38397513, 66.70297933, 290.59956355, color='black') # kam 4

# rysowanie twarzy
for i in range(60):
    ax.scatter(dlugosc[i][0], dlugosc[i][1], dlugosc[i][2], color=next(colors),s=1)

plt.ylabel('Y')
plt.xlabel('X')
plt.show()
