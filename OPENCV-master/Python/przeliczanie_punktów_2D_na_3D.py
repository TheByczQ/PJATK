import numpy as np
import cv2
"""
macierz R|T
"""
rotacjaitranslacja=np.array([[ 0.78556781 ,-0.01551702,  0.61858099,994.79112564],
 [ 0.03724109,  0.99905895 ,-0.02223312,  60.44413139],
 [-0.61765388 , 0.04050226 , 0.78540642,588.20481106]])
"""
camera matrix
"""
kameramatrix=np.array([[4.38160541e+03 ,0.00000000e+00, 1.02505064e+03],
 [0.00000000e+00, 4.38565816e+03, 6.19180367e+02],
 [0.00000000e+00 ,0.00000000e+00 ,1.00000000e+00]])
"""
punkt w pixelach na klatce video
"""
x=np.array([[1920/2], [600], [1]])
"""
macierze projekcji
"""
projekcji=kameramatrix@rotacjaitranslacja
"""
odwrocone macierze projekcji
"""
projekcjinv=cv2.invert(projekcji,flags=cv2.DECOMP_SVD)
"""
wektor 4x1 z punktami i skalarem
"""
punkt=projekcjinv[1]@x
punkt=punkt/punkt[3]
print(punkt)
sprawdzenie=projekcji@punkt
print(sprawdzenie/sprawdzenie[2])

"""
punkty z 1 klatki nagrania danych kamer
"""
punktykamery3=[np.array([[926], [520], [1]]), np.array([[936], [592], [1]]), np.array([[955], [658], [1]]), np.array([[974], [723], [1]]), np.array([[997], [785], [1]]), np.array([[1030], [843], [1]]), np.array([[1072], [895], [1]]), np.array([[1123], [937], [1]]), np.array([[1182], [947], [1]]), np.array([[1244], [934], [1]]), np.array([[1302], [894], [1]]), np.array([[1352], [841], [1]]), np.array([[1393], [780], [1]]), np.array([[1419], [709], [1]]), np.array([[1433], [632], [1]]), np.array([[1442], [553], [1]]), np.array([[1444], [474], [1]]), np.array([[936], [499], [1]]), np.array([[966], [470], [1]]), np.array([[1008], [467], [1]]), np.array([[1052], [477], [1]]), np.array([[1095], [495], [1]]), np.array([[1187], [490], [1]]), np.array([[1232], [468], [1]]), np.array([[1282], [452], [1]]), np.array([[1332], [452], [1]]), np.array([[1376], [472], [1]]), np.array([[1147], [545], [1]]), np.array([[1150], [600], [1]]), np.array([[1151], [655], [1]]), np.array([[1153], [711], [1]]), np.array([[1107], [731], [1]]), np.array([[1131], [741], [1]]), np.array([[1159], [748], [1]]), np.array([[1188], [738], [1]]), np.array([[1212], [725], [1]]), np.array([[991], [551], [1]]), np.array([[1020], [545], [1]]), np.array([[1052], [545], [1]]), np.array([[1085], [559], [1]]), np.array([[1052], [568], [1]]), np.array([[1018], [568], [1]]), np.array([[1230], [551], [1]]), np.array([[1260], [533], [1]]), np.array([[1294], [530], [1]]), np.array([[1329], [533], [1]]), np.array([[1298], [551], [1]]), np.array([[1264], [556], [1]]), np.array([[1079], [809], [1]]), np.array([[1109], [798], [1]]), np.array([[1138], [789], [1]]), np.array([[1161], [794], [1]]), np.array([[1186], [786], [1]]), np.array([[1220], [790], [1]]), np.array([[1257], [798], [1]]), np.array([[1223], [828], [1]]), np.array([[1191], [842], [1]]), np.array([[1164], [846], [1]]), np.array([[1140], [845], [1]]), np.array([[1109], [834], [1]]), np.array([[1093], [810], [1]]), np.array([[1139], [810], [1]]), np.array([[1162], [813], [1]]), np.array([[1187], [808], [1]]), np.array([[1241], [801], [1]]), np.array([[1187], [809], [1]]), np.array([[1162], [815], [1]]), np.array([[1138], [812], [1]])]
punktykamery4=[np.array([[940], [630], [1]]), np.array([[946], [703], [1]]), np.array([[956], [776], [1]]), np.array([[977], [846], [1]]), np.array([[1019], [905], [1]]), np.array([[1076], [952], [1]]), np.array([[1142], [985], [1]]), np.array([[1214], [1002], [1]]), np.array([[1273], [995], [1]]), np.array([[1311], [974], [1]]), np.array([[1326], [930], [1]]), np.array([[1332], [880], [1]]), np.array([[1340], [829], [1]]), np.array([[1349], [783], [1]]), np.array([[1356], [738], [1]]), np.array([[1358], [694], [1]]), np.array([[1352], [651], [1]]), np.array([[1087], [625], [1]]), np.array([[1128], [604], [1]]), np.array([[1175], [592], [1]]), np.array([[1224], [596], [1]]), np.array([[1265], [612], [1]]), np.array([[1328], [611], [1]]), np.array([[1344], [595], [1]]), np.array([[1363], [583], [1]]), np.array([[1379], [576], [1]]), np.array([[1391], [583], [1]]), np.array([[1298], [666], [1]]), np.array([[1311], [709], [1]]), np.array([[1324], [752], [1]]), np.array([[1338], [795], [1]]), np.array([[1261], [822], [1]]), np.array([[1288], [827], [1]]), np.array([[1315], [832], [1]]), np.array([[1334], [823], [1]]), np.array([[1347], [807], [1]]), np.array([[1128], [669], [1]]), np.array([[1159], [658], [1]]), np.array([[1190], [656], [1]]), np.array([[1213], [672], [1]]), np.array([[1189], [682], [1]]), np.array([[1158], [682], [1]]), np.array([[1316], [662], [1]]), np.array([[1336], [644], [1]]), np.array([[1359], [639], [1]]), np.array([[1372], [648], [1]]), np.array([[1362], [663], [1]]), np.array([[1339], [666], [1]]), np.array([[1201], [893], [1]]), np.array([[1249], [878], [1]]), np.array([[1288], [867], [1]]), np.array([[1307], [870], [1]]), np.array([[1321], [862], [1]]), np.array([[1330], [864], [1]]), np.array([[1331], [875], [1]]), np.array([[1328], [897], [1]]), np.array([[1319], [911], [1]]), np.array([[1304], [917], [1]]), np.array([[1283], [919], [1]]), np.array([[1246], [912], [1]]), np.array([[1219], [892], [1]]), np.array([[1286], [888], [1]]), np.array([[1306], [886], [1]]), np.array([[1319], [882], [1]]), np.array([[1323], [876], [1]]), np.array([[1319], [881], [1]]), np.array([[1306], [888], [1]]), np.array([[1286], [889], [1]])]
punktykamery2=[np.array([[795], [634], [1]]), np.array([[792], [682], [1]]), np.array([[799], [728], [1]]), np.array([[811], [776], [1]]), np.array([[823], [828], [1]]), np.array([[832], [884], [1]]), np.array([[840], [938], [1]]), np.array([[856], [994], [1]]), np.array([[903], [1021], [1]]), np.array([[976], [1022], [1]]), np.array([[1059], [997], [1]]), np.array([[1130], [953], [1]]), np.array([[1195], [898], [1]]), np.array([[1239], [829], [1]]), np.array([[1258], [746], [1]]), np.array([[1264], [655], [1]]), np.array([[1266], [564], [1]]), np.array([[741], [560], [1]]), np.array([[746], [548], [1]]), np.array([[760], [550], [1]]), np.array([[778], [562], [1]]), np.array([[796], [578], [1]]), np.array([[861], [572], [1]]), np.array([[910], [550], [1]]), np.array([[968], [539], [1]]), np.array([[1025], [551], [1]]), np.array([[1074], [573], [1]]), np.array([[833], [635], [1]]), np.array([[820], [687], [1]]), np.array([[805], [738], [1]]), np.array([[789], [790], [1]]), np.array([[787], [797], [1]]), np.array([[803], [816], [1]]), np.array([[825], [826], [1]]), np.array([[856], [817], [1]]), np.array([[887], [808], [1]]), np.array([[769], [625], [1]]), np.array([[778], [622], [1]]), np.array([[798], [624], [1]]), np.array([[820], [632], [1]]), np.array([[799], [635], [1]]), np.array([[780], [635], [1]]), np.array([[935], [635], [1]]), np.array([[959], [624], [1]]), np.array([[988], [625], [1]]), np.array([[1025], [627], [1]]), np.array([[991], [639], [1]]), np.array([[961], [640], [1]]), np.array([[832], [880], [1]]), np.array([[819], [863], [1]]), np.array([[824], [858], [1]]), np.array([[838], [865], [1]]), np.array([[858], [860], [1]]), np.array([[903], [869], [1]]), np.array([[959], [886], [1]]), np.array([[914], [919], [1]]), np.array([[873], [931], [1]]), np.array([[852], [931], [1]]), np.array([[836], [926], [1]]), np.array([[829], [908], [1]]), np.array([[840], [880], [1]]), np.array([[829], [879], [1]]), np.array([[842], [882], [1]]), np.array([[862], [882], [1]]), np.array([[941], [887], [1]]), np.array([[866], [898], [1]]), np.array([[846], [898], [1]]), np.array([[831], [891], [1]])]
"""
przeksztaÅ‚cenie punktÃ³w 2D z 1 klatki na punkty 3D
"""
punktowania=[]
for i in range (len(punktykamery2)):
    kalamarnica=projekcjinv[1]@punktykamery2[i]
    kozakooo=kalamarnica / kalamarnica[3]
    punktowania.append([kozakooo[:3]])
print(punktowania)